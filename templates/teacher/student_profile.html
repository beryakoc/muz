{% extends 'base.html' %}

{% block title %}Student Profile - {{ student.get_full_name }} - University SIS{% endblock %}

{% block content %}
<h1>Student Profile</h1>

<div style="margin-bottom: 2rem; padding: 1rem; background-color: #e7f3ff; border-radius: 4px;">
    <h2>{{ student.get_full_name }}</h2>
    <p><strong>Email:</strong> {{ student.email }}</p>
    <p><em>Showing only courses taught by you</em></p>
</div>

{% if courses_data %}
    {% for course_data in courses_data %}
    <div style="margin-bottom: 3rem; padding: 1.5rem; background-color: #f8f9fa; border-radius: 8px;">
        <h2>{{ course_data.course.code }} - {{ course_data.course.name }}</h2>
        
        {% if course_data.assessments %}
        <div style="margin-top: 1.5rem;">
            <h3>Grades per Course</h3>
            <table>
                <thead>
                    <tr>
                        <th>Assessment</th>
                        <th>Type</th>
                        <th>Score</th>
                        <th>Letter Grade</th>
                        <th>Weight</th>
                    </tr>
                </thead>
                <tbody>
                    {% for assessment_data in course_data.assessments %}
                    <tr>
                        <td>{{ assessment_data.assessment.name }}</td>
                        <td>{{ assessment_data.assessment.get_assessment_type_display }}</td>
                        <td>{{ assessment_data.score }}</td>
                        <td>{{ assessment_data.letter_grade|default:"-" }}</td>
                        <td>{{ assessment_data.assessment.weight_percentage }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        
        {% if course_data.total_grade is not None %}
        <div style="margin-top: 1.5rem;">
            <h3>Course Grade</h3>
            <p><strong>Total Grade:</strong> {{ course_data.total_grade|floatformat:2 }}%</p>
            <p><strong>Letter Grade:</strong> {{ course_data.letter_grade }}</p>
        </div>
        {% endif %}
        
        {% if course_data.lo_achievements %}
        <div style="margin-top: 1.5rem;">
            <h3>LO Performance per Course</h3>
            <table>
                <thead>
                    <tr>
                        <th>Learning Outcome</th>
                        <th>Final LO Value</th>
                    </tr>
                </thead>
                <tbody>
                    {% for lo_code, achievement in course_data.lo_achievements.items %}
                    <tr>
                        <td><strong>{{ lo_code }}</strong></td>
                        <td>{{ achievement|floatformat:2 }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="margin-top: 1.5rem;">
            <p><em>No LO performance data available for this course.</em></p>
        </div>
        {% endif %}
    </div>
    {% endfor %}
{% else %}
    <p>This student is not enrolled in any courses taught by you.</p>
{% endif %}

{% if department_po_values %}
<div style="margin-top: 3rem; padding: 1.5rem; background-color: #f8f9fa; border-radius: 8px;">
    <h2>Department Program Outcomes (PO)</h2>
    <p style="color: #666; margin-bottom: 1rem;">These values are calculated across all courses using the formula: PO = sum(LO_value Ã— LO_percentage / 100)</p>
    <table>
        <thead>
            <tr>
                <th>Program Outcome</th>
                <th>Final PO Value</th>
            </tr>
        </thead>
        <tbody>
            {% for po_code, po_value in department_po_values.items %}
            <tr>
                <td><strong>{{ po_code }}</strong></td>
                <td>{{ po_value|floatformat:2 }}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<a href="{% url 'teacher_students' %}" class="btn" style="margin-top: 1rem;">Back to My Students</a>
{% endblock %}

